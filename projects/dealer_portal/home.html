<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TCD</title>
    <link rel="apple-touch-icon" type="image/png" href="https://cpwebassets.codepen.io/assets/favicon/apple-touch-icon-5ae1a0698dcc2402e9712f7d01ed509a57814f994c660df9f7a952f3060705ee.png" />
    <meta name="apple-mobile-web-app-title" content="TCD">
    <link rel="shortcut icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico" />
    <link rel="mask-icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/logo-pin-b4b4269c16397ad2f0f7a01bcdf513a1994f4c94b8af2f191c09eb0d601762b1.svg" color="#111" />
    <link rel="canonical" href="https://codepen.io/ritaniks/pen/LYGypNz">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/css/tempusdominus-bootstrap-4.min.css" />
    <link href="https://use.fontawesome.com/releases/v5.10.2/css/all.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css'>
    <link rel='stylesheet' href='https://unpkg.com/css-pro-layout@1.1.0/dist/css/css-pro-layout.css'>
    <link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&amp;display=swap'>
    <link href="/projects/dealer_portal/sidebar.css" rel="stylesheet" />
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/css/tempusdominus-bootstrap-4.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <link href="/projects/dealer_portal/style.css" rel="stylesheet" />
</head>
<body>
<div class="layout has-sidebar fixed-sidebar fixed-header">
    <aside id="sidebar" class="sidebar break-point-sm has-bg-image">
        <a id="btn-collapse" class="sidebar-collapser">
            <i class="ri-arrow-left-s-line"></i>
        </a>
        <div class="sidebar-layout">
            <div class="sidebar-header">
                <div class="pro-sidebar-logo">
                    <div>U</div>
                    <h5 id="username-h5"></h5>
                </div>
            </div>
            <div class="sidebar-content">
                <nav class="menu open-current-submenu">
                    <ul>
                        <li class="menu-header" style="padding-top: 20px">
                            <span> General </span>
                        </li>
                        <li id="view_doc_link" class="menu-item">
                            <a href="#">
                                <span class="menu-icon">
                                  <i class="ri-book-2-fill"></i>
                                </span>
                                <span class="menu-title">View Documents</span>
                                <span class="menu-suffix">
                                  <span class="badge secondary">New</span>
                                </span>
                            </a>
                        </li>
                        <li id="admin-1" class="menu-header" style="padding-top: 20px; display: none">
                            <span> Admin </span>
                        </li>
                        <li id="create_user_link" class="menu-item" style="display: none">
                            <a href="#">
                                <span class="menu-icon">
                                  <i class="ri-book-2-fill"></i>
                                </span>
                                <span class="menu-title">Create User</span>
                            </a>
                        </li>
                        <li class="menu-header" style="padding-top: 20px;">
                            <span> Account </span>
                        </li>
                        <li id="logout_link" class="menu-item">
                            <a href="#">
                                <span class="menu-icon">
                                  <i class="ri-book-2-fill"></i>
                                </span>
                                <span class="menu-title">Logout</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="sidebar-footer">
                Copyright TCD
            </div>
        </div>
    </aside>
    <div id="overlay" class="overlay"></div>
    <div class="layout">
        <main class="content">
            <div>
                <a id="btn-toggle" href="#" class="sidebar-toggler break-point-sm">
                    <i class="ri-menu-line ri-xl"></i>
                </a>
                <h1>
                    TCD Dealer Portal
                </h1>
                <h3 id="h3" style="margin-top:20px">
                    Documents
                </h3>
                <div style="display: inline-block">
                    <div id="document_container" class="cover-container d-flex w-100 mb-auto mx-auto flex-column bg-white shadow-sm rounded">
                        <ul id="myTab1" role="tablist" class="nav nav-tabs nav-pills lined flex-column flex-sm-row flex-nowrap flex-row text-center bg-white mt-0 mb-4">
                            <li class="nav-item flex-fill">
                                <a id="pills-time-tab" data-toggle="tab" href="#pills-time" role="tab" aria-controls="pills-time" aria-selected="false" class="nav-link rounded-0 active">
                                    <i class="far fa-clock icon"></i>Tab 1 </a>
                            </li>
                            <li class="nav-item flex-fill">
                                <a id="pills-expenses-tab" data-toggle="tab" href="#pills-expenses" role="tab" aria-controls="pills-expenses" aria-selected="false" class="nav-link rounded-0">
                                    <i class="fas fa-file-invoice-dollar icon"></i>Tab 2 </a>
                            </li>
                        </ul>
                        <div class="tab-content pb-5 px-3 px-sm-4" id="pills-tabContent">
                            <div class="tab-pane fade show active" id="pills-time" role="tabpanel" aria-labelledby="pills-time-tab">
                                Content here
                            </div>
                            <div class="tab-pane fade" id="pills-expenses" role="tabpanel" aria-labelledby="pills-expenses-tab">
                                Content here
                            </div>
                        </div>
                    </div>
                    <div id="create_user_container" class="cover-container d-flex w-100 mb-auto mx-auto flex-column bg-white shadow-sm rounded" style="display: none !important">
                        <div id="create_user" class="dflex flex_dir_col" style="min-width: 325px; padding: 30px">
                            <input id="create_username_input" placeholder="username"/>
                            <input id="create_pw_input" placeholder="password"/>
                            <input id="create_type_input" placeholder="type (must be admin or user)"/>
                            <button type="button" id="initiate_user_creation" class="cpointer blue_button" data-value="Create">
                                Create
                            </button>
                            <div id='create_user_message' style="height: 20px"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <div class="overlay"></div>
    </div>
</div>
<script src='https://unpkg.com/@popperjs/core@2'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/moment.min.js" integrity="sha256-VBLiveTKyUZMEzJd6z2mhfxIqz3ZATCuVMawPZGzIfA=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="/projects/dealer_portal/sidebar.js"></script>
<script src="/projects/dealer_portal/utilities.js"></script>
<script>

    // Constants
    const socket = io()
    const cookies = getExistingCookies()
    const username_cookie = getCookieData('username', cookies)
    const initiate_user_creation_btn = document.getElementById('initiate_user_creation')
    const create_user_msg_div = document.getElementById('create_user_message')

    // Socket actions
    socket.on('cookies_validation_failure', () => deleteCookiesAndRedirect())
    socket.on('cookies_validated', (res) => {
        document.getElementById('username-h5').innerHTML = username_cookie
        if (res[0]['type'] === 'admin') {
            document.getElementById('admin-1').style.display = "block"
            document.getElementById('create_user_link').style.display = "block"
        }
    })
    socket.on('create_user_return', (res) => {
        if (res[1])
            create_user_msg_div.innerText = "User Created Successfully!"
        else
            create_user_msg_div.innerText = res[2]
        setBtnToDefault(initiate_user_creation_btn)
    })

    // Check if user is signed in
    // If not, redirect to login page
    if (username_cookie === null || getCookieData('session_id', cookies) === null)
        redirectLoggedOutUser()
    else checkForLoggedInUser()

    // Create user action
    document.getElementById('create_user_link').onclick = () => {
        document.getElementById('h3').innerText = "Create User"
        document.getElementById('document_container').setAttribute('style',"display: none !important")
        document.getElementById('create_user_container').setAttribute('style',"display: flex !important")
    }

    // Create user action
    document.getElementById('view_doc_link').onclick = () => {
        document.getElementById('h3').innerText = "Documents"
        document.getElementById('document_container').setAttribute('style',"display: flex !important")
        document.getElementById('create_user_container').setAttribute('style',"display: none !important")
    }

    // Logout action
    document.getElementById('logout_link').onclick = () => deleteCookiesAndRedirect()

    // Initiate User creation by admin
    initiate_user_creation_btn.onclick = () => {
        setBtnToLoading(initiate_user_creation_btn)
        const data = [
            document.getElementById('create_username_input').value,
            document.getElementById('create_pw_input').value,
            document.getElementById('create_type_input').value
        ]
        if (!(data[0] === null || data[1] === null || data[0].length < 1 || data[1].length < 1 || !(data[2] === 'user' || data[2] === 'admin'))) {
            socket.emit('create_user', data)
        } else {
            setBtnToDefault(initiate_user_creation_btn)
            create_user_msg_div.innerText = "Error. Are the fields filled out? Is the type 'user' or 'admin'?"
        }
    }

</script>
</body>
</html>